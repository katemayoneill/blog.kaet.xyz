---
// src/pages/pinterest-callback.astro
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title="Pinterest Authorization" description="Pinterest OAuth callback" />
		<style>
			.callback-container {
				max-width: 600px;
				margin: 2rem auto;
				padding: 2rem;
				background: #f8f9fa;
				border-radius: 8px;
				text-align: center;
			}
			.code-display {
				background: #fff;
				border: 2px solid #e9ecef;
				border-radius: 4px;
				padding: 1rem;
				margin: 1rem 0;
				font-family: monospace;
				word-break: break-all;
				user-select: all;
			}
			.copy-button {
				background: #007bff;
				color: white;
				border: none;
				padding: 0.5rem 1rem;
				border-radius: 4px;
				cursor: pointer;
				margin: 0.5rem;
			}
			.copy-button:hover {
				background: #0056b3;
			}
			.instructions {
				text-align: left;
				background: #fff;
				padding: 1.5rem;
				border-radius: 4px;
				margin-top: 2rem;
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<div class="callback-container">
				<h1>Pinterest Authorization</h1>
				<div id="content">
					<p>Processing authorization...</p>
				</div>
			</div>
		</main>
		<Footer />

		<script>
			// Extract code from URL parameters
			const urlParams = new URLSearchParams(window.location.search);
			const code = urlParams.get('code');
			const error = urlParams.get('error');
			const contentDiv = document.getElementById('content');

			if (error) {
				contentDiv.innerHTML = `
					<h2 style="color: red;">Authorization Failed</h2>
					<p>Error: ${error}</p>
					<p>Please try the authorization process again.</p>
				`;
			} else if (code) {
				contentDiv.innerHTML = `
					<h2 style="color: green;">Authorization Successful!</h2>
					<p>Your authorization code is:</p>
					<div class="code-display" id="authCode">${code}</div>
					<button class="copy-button" onclick="copyCode()">Copy Code</button>
					
					<div class="instructions">
						<h3>Next Steps:</h3>
						<ol>
							<li>Copy the authorization code above</li>
							<li>Run your OAuth setup script locally:</li>
							<code style="display: block; background: #f8f9fa; padding: 0.5rem; margin: 0.5rem 0;">
								PINTEREST_CLIENT_ID=your_id PINTEREST_CLIENT_SECRET=your_secret node scripts/pinterest-oauth.js
							</code>
							<li>Use the <code>exchangeCodeForTokens("${code}")</code> function with your code</li>
							<li>Add the returned tokens to your environment variables</li>
						</ol>
					</div>
				`;
			} else {
				contentDiv.innerHTML = `
					<h2>No Authorization Code Found</h2>
					<p>This page is used for Pinterest OAuth callbacks. Please start the authorization process from your OAuth setup script.</p>
				`;
			}

			function copyCode() {
				const codeElement = document.getElementById('authCode');
				const textArea = document.createElement('textarea');
				textArea.value = codeElement.textContent;
				document.body.appendChild(textArea);
				textArea.select();
				document.execCommand('copy');
				document.body.removeChild(textArea);
				
				const button = event.target;
				const originalText = button.textContent;
				button.textContent = 'Copied!';
				button.style.background = '#28a745';
				setTimeout(() => {
					button.textContent = originalText;
					button.style.background = '#007bff';
				}, 2000);
			}
		</script>
	</body>
</html>